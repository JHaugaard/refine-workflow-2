# Workflow Manifest v3 - Loaded on-demand by workflow-status orchestrator
# Schema documentation: implementation-plan-v3.md

schema_version: "3.0"
workflow: project-development
version: 1.0.0
handoff_directory: ".docs/"

phases:
  discovery:
    name: "Discovery"
    description: "Understanding the problem space"
  architecture:
    name: "Architecture"
    description: "Technical decisions and design"
  planning:
    name: "Planning"
    description: "Deployment and infrastructure strategy"
  implementation:
    name: "Implementation"
    description: "Project generation and setup"
  quality:
    name: "Quality"
    description: "Testing infrastructure"
  release:
    name: "Release"
    description: "Deployment and automation"

skills:
  project-brief-writer:
    phase: discovery
    description: "Transform rough ideas into structured project briefs"
    requires: []
    outputs:
      - ".docs/brief.json"
      - ".docs/PROJECT-MODE.md"
    next: tech-stack-advisor  # Default (overridden by gate below)
    entry_point: true

  solution-architect:
    phase: architecture
    description: "Resolve architectural ambiguity for complex projects"
    optional: true  # Metadata hint only
    requires:
      - ".docs/brief.json"
    outputs:
      - ".docs/architecture-context.json"
    next: tech-stack-advisor

  tech-stack-advisor:
    phase: architecture
    description: "Recommend technology stack with rationale"
    requires:
      - ".docs/brief.json"
    optional_inputs:
      - ".docs/architecture-context.json"
    outputs:
      - ".docs/tech-stack-decision.json"
    next: deployment-advisor

  deployment-advisor:
    phase: planning
    description: "Recommend hosting and deployment strategy"
    requires:
      - ".docs/tech-stack-decision.json"
    outputs:
      - ".docs/deployment-strategy.json"
    next: project-spinup

  project-spinup:
    phase: implementation
    description: "Generate project foundation with CLAUDE.md and structure"
    requires:
      - ".docs/tech-stack-decision.json"
      - ".docs/deployment-strategy.json"
    outputs:
      - ".docs/project-foundation.json"
      - "CLAUDE.md"
    next: deploy-guide  # Default (overridden by gate below for localhost)

  test-orchestrator:
    phase: quality
    description: "Set up testing infrastructure and strategy"
    optional: true
    standalone: true  # Can be invoked anytime after tech-stack
    requires:
      - ".docs/tech-stack-decision.json"
    outputs:
      - ".docs/test-strategy.md"
    next: null  # Returns to previous flow

  deploy-guide:
    phase: release
    description: "Guide through actual deployment steps"
    requires:
      - ".docs/deployment-strategy.json"
    outputs:
      - ".docs/deployment-log.json"
    next: null
    termination: true

  ci-cd-implement:
    phase: release
    description: "Implement CI/CD pipelines"
    optional: true
    requires:
      - ".docs/deployment-strategy.json"
    outputs:
      - ".github/workflows/ci.yml"
      - ".github/workflows/deploy.yml"
      - "CICD-SECRETS.md"
    next: null
    termination: true

# Decision gates - OVERRIDE skill's `next` when present
decision_gates:
  - after: project-brief-writer
    ask: "Does this project need architecture review?"
    routes:
      yes: solution-architect
      no: tech-stack-advisor

  - after: project-spinup
    # Only show this gate if NOT localhost
    condition:
      source: ".docs/deployment-strategy.json"
      field: "hosting.type"
      op: "not_equals"
      value: "localhost"
    ask: "Project foundation ready. Deploy now or develop first?"
    routes:
      deploy: deploy-guide
      develop: null  # Pause workflow

  - after: project-spinup
    # Localhost projects terminate here
    condition:
      source: ".docs/deployment-strategy.json"
      field: "hosting.type"
      op: "equals"
      value: "localhost"
    auto_terminate: true
    label: "Localhost/Native - Development Ready"

  - after: deploy-guide
    ask: "Set up CI/CD automation?"
    routes:
      yes: ci-cd-implement
      no: null  # End workflow

# Named workflow variants
variants:
  minimal:
    description: "Fast path for simple localhost projects"
    skills: [project-brief-writer, tech-stack-advisor, deployment-advisor, project-spinup]
  standard:
    description: "Standard path through deployment"
    skills: [project-brief-writer, tech-stack-advisor, deployment-advisor, project-spinup, deploy-guide]
  full:
    description: "Complete path with all optional phases"
    skills: all

# Explicit termination points for documentation/validation
termination_points:
  - after: project-spinup
    label: "Localhost/Native - Development Ready"
    condition:
      source: ".docs/deployment-strategy.json"
      field: "hosting.type"
      op: "equals"
      value: "localhost"
  - after: deploy-guide
    label: "Manual Deployment Complete"
    default: true
  - after: ci-cd-implement
    label: "Full CI/CD Automation"
